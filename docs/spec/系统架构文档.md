# 系统架构文档

## 1. 架构概述

本项目采用前后端分离的架构模式，后端基于Spring Boot构建单体多模块应用，前端采用Vue.js技术栈。系统设计遵循高内聚、低耦合的原则，确保系统的可维护性和可扩展性。

## 2. 技术选型

### 2.1. 后端技术栈

| 技术分类 | 技术选型 | 版本 | 说明 |
|---------|---------|------|------|
| **核心框架** | Spring Boot | 3.x | 主框架，提供自动配置和快速开发能力 |
| **JDK版本** | JDK | 21 | Java开发工具包 |
| **Web框架** | Spring MVC | 6.x | RESTful API开发 |
| **安全框架** | Spring Security | 6.x | 认证授权、安全防护 |
| **数据访问** | MyBatis-Plus | 3.5.x | ORM框架，简化数据库操作，使用mybatis-plus-spring-boot3-starter |
| **对象转换** | MapStruct | 1.5.x | DTO/Entity转换工具，编译时生成映射代码 |
| **数据库** | MySQL | 8.0.x | 主数据库 |
| **缓存** | Redis | 6.2.x | 分布式缓存、会话存储 |
| **分布式锁** | Redisson | 3.x | 分布式锁、分布式对象 |
| **消息中间件** | RocketMQ | 5.x | 异步消息处理 |
| **连接池** | HikariCP | 4.0.x | 高性能数据库连接池 |
| **JSON处理** | Jackson | 2.13.x | JSON序列化/反序列化 |
| **参数校验** | Jakarta Validation | 3.0.x | 参数校验框架，Spring Boot 3.x兼容 |
| **文档生成** | Knife4j | 3.0.x | API文档生成 |
| **Excel处理** | EasyExcel | 3.x | Excel文件读写 |
| **对象存储** | MinIO | 8.4.x | 文件存储服务 |
| **消息推送** | WebSocket | - | 实时消息推送 |
| **日志框架** | Logback | 1.2.x | 日志记录 |
| **监控** | Spring Boot Actuator | 3.x | 应用监控 |
| **工具类** | Hutool | 5.8.x | Java工具类库 |

### 2.2. 前端技术栈

| 技术分类 | 技术选型 | 版本 | 说明 |
|---------|---------|------|------|
| **核心框架** | Vue.js | 3.x | 渐进式JavaScript框架 |
| **UI组件库** | Element Plus | 2.x | 基于Vue 3的组件库 |
| **路由管理** | Vue Router | 4.x | 官方路由管理器 |
| **状态管理** | Pinia | 2.x | 新一代状态管理库 |
| **HTTP客户端** | Axios | 1.x | HTTP请求库 |
| **构建工具** | Vite | 4.x | 现代化构建工具 |
| **图表库** | ECharts | 5.x | 数据可视化图表库 |

### 2.3. 开发工具

- **IDE**: IntelliJ IDEA
- **版本控制**: Git
- **项目管理**: Maven
- **数据库管理**: Navicat / DataGrip
- **API测试**: Postman / Apifox

## 3. 系统架构设计

### 3.1. 整体架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端应用层     │    │   网关/负载均衡   │    │   后端应用层     │
│                │    │                │    │                │
│  Vue.js 3.x    │◄──►│   Nginx/       │◄──►│  Spring Boot   │
│  Element Plus  │    │   Apache       │    │  Spring MVC    │
│  Vue Router    │    │                │    │  Spring Security│
│  Pinia         │    │                │    │                │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                       │
                                                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   文件存储层     │    │   缓存层        │    │   数据持久层     │
│                │    │                │    │                │
│    MinIO       │◄──►│     Redis      │◄──►│     MySQL      │
│  (对象存储)     │    │   (缓存/会话)   │    │   (主数据库)    │
│                │    │                │    │                │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 3.2. 后端模块架构

采用传统多模块架构，按功能模块划分：

#### 3.2.1. 四层模块架构

```
┌─────────────────────────────────────┐
│          Dependencies 层            │  ← 依赖管理：版本统一管理
├─────────────────────────────────────┤
│           Framework 层              │  ← 框架封装：技术组件封装
├─────────────────────────────────────┤
│            Module 层                │  ← 业务模块：功能模块划分
│  ┌─────────────────────────────────┐ │
│  │           API 包               │ │  ← 接口定义：对外暴露接口
│  ├─────────────────────────────────┤ │
│  │           BIZ 包               │ │  ← 业务实现：具体业务逻辑
│  │  ├── controller/              │ │
│  │  ├── service/                 │ │
│  │  ├── mapper/                  │ │
│  │  └── entity/                  │ │
│  └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│             Server 层               │  ← 启动服务：应用启动入口
└─────────────────────────────────────┘
```

**各层职责**：
- **Dependencies层**: Maven BOM依赖版本统一管理，解决依赖冲突
- **Framework层**: 技术组件封装，提供开箱即用的Spring Boot Starter
- **Module层**: 业务功能模块，API包定义接口，BIZ包实现业务逻辑
- **Server层**: 应用启动入口，集成所有模块，提供运行环境

#### 1. 依赖管理层 (admin-dependencies)
- **作用**: Maven BOM依赖版本统一管理
- **职责**: 定义所有Maven依赖版本号，解决依赖冲突
- **优势**: 类似Spring Boot的依赖管理机制，支持多模块复用

#### 2. 框架封装层 (admin-framework)
采用Spring Boot Starter模式，每个组件包含core包和config包：

**技术组件 (Technology Components)**
- `admin-spring-boot-starter-web`: Web封装，全局异常、访问日志、API文档
- `admin-spring-boot-starter-security`: 认证授权，基于Spring Security
- `admin-spring-boot-starter-mybatis`: 数据库操作，基于MyBatis Plus，集成MapStruct对象转换
- `admin-spring-boot-starter-redis`: 缓存操作，基于Redis + Redisson
- `admin-spring-boot-starter-mq`: 消息队列，支持集群和广播消费
- `admin-spring-boot-starter-job`: 定时任务，基于Quartz集群模式
- `admin-spring-boot-starter-excel`: Excel导入导出，基于EasyExcel
- `admin-spring-boot-starter-monitor`: 服务监控，链路追踪、指标收集
- `admin-spring-boot-starter-protection`: 服务保障，幂等、分布式锁、限流
- `admin-spring-boot-starter-websocket`: WebSocket支持，Token认证、集群广播

**业务组件 (Business Components)**
- `admin-spring-boot-starter-biz-data-permission`: 数据权限控制
- `admin-spring-boot-starter-biz-operatelog`: 操作日志记录

#### 3. 业务模块层 (admin-module-xxx)
按业务领域划分的功能模块：

**核心业务模块**
- `admin-module-system`: 系统管理模块
  - 用户管理、角色权限、菜单管理
  - 字典管理、参数配置、通知公告
- `admin-module-infra`: 基础设施模块
  - 文件管理、配置管理、定时任务
  - 代码生成、API文档、系统监控
- `admin-module-log`: 日志管理模块
  - 操作日志、登录日志、系统日志
  - 日志查询、统计分析
- `admin-module-monitor`: 系统监控模块
  - 在线用户、服务器监控、缓存监控
  - 性能指标、健康检查
- `admin-module-report`: 数据报表模块
  - 报表设计、数据统计、图表展示
  - 大屏展示、数据导出

#### 4. 启动服务层 (admin-server)
- **admin-common**: 公共基础模块，核心工具类、枚举、异常定义
- **admin-server**: 服务启动模块，包含启动类和多环境配置

#### 3.2.3 典型调用链路

以用户管理功能为例，展示四层架构的典型调用链路：

```java
// 1. API层 - 接口定义 (admin-module-system-api)
@FeignClient(name = "admin-system", path = "/admin-api/system")
public interface UserApi {
    
    @GetMapping("/user/page")
    CommonResult<PageResult<UserRespVO>> getUserPage(@Valid UserPageReqVO reqVO);
    
    @GetMapping("/user/get")
    CommonResult<UserRespVO> getUser(@RequestParam("id") Long id);
}

// 2. BIZ层 - Controller (admin-module-system-biz)
@RestController
@RequestMapping("/admin-api/system/user")
@Validated
public class UserController {
    
    @Resource
    private UserService userService;
    
    @GetMapping("/page")
    @Operation(summary = "获得用户分页")
    public CommonResult<PageResult<UserRespVO>> getUserPage(@Valid UserPageReqVO reqVO) {
        PageResult<UserDO> pageResult = userService.getUserPage(reqVO);
        return success(UserConvert.INSTANCE.convertPage(pageResult));
    }
}

// 3. BIZ层 - Service (admin-module-system-biz)
@Service
@Validated
public class UserServiceImpl implements UserService {
    
    @Resource
    private UserMapper userMapper;
    
    @Override
    public PageResult<UserDO> getUserPage(UserPageReqVO reqVO) {
        return userMapper.selectPage(reqVO);
    }
    
    @Override
    @Transactional(rollbackFor = Exception.class)
    public Long createUser(UserCreateReqVO reqVO) {
        // 校验用户存在
        validateUserExists(reqVO.getUsername(), null);
        // 插入用户
        UserDO user = UserConvert.INSTANCE.convert(reqVO);
        user.setPassword(passwordEncoder.encode(reqVO.getPassword()));
        userMapper.insert(user);
        return user.getId();
    }
}

// 4. BIZ层 - Mapper (admin-module-system-biz)
@Mapper
public interface UserMapper extends BaseMapperX<UserDO> {
    
    default PageResult<UserDO> selectPage(UserPageReqVO reqVO) {
        return selectPage(reqVO, new LambdaQueryWrapperX<UserDO>()
                .likeIfPresent(UserDO::getUsername, reqVO.getUsername())
                .likeIfPresent(UserDO::getMobile, reqVO.getMobile())
                .eqIfPresent(UserDO::getStatus, reqVO.getStatus())
                .betweenIfPresent(UserDO::getCreateTime, reqVO.getCreateTime())
                .orderByDesc(UserDO::getId));
    }
}

// 5. Framework层 - 基础组件 (admin-spring-boot-starter-mybatis)
@Component
public abstract class BaseMapperX<T> extends BaseMapper<T> {
    
    default PageResult<T> selectPage(IPage<T> page, Wrapper<T> queryWrapper) {
        IPage<T> mpPage = selectPage(page, queryWrapper);
        return new PageResult<>(mpPage.getRecords(), mpPage.getTotal());
    }
}
```

#### 3.2.4 模块结构详情

```
admin-backend/
├── admin-dependencies/              # 依赖管理层
│   └── pom.xml                      # BOM依赖版本管理
├── admin-framework/                 # 框架封装层
│   ├── admin-spring-boot-starter-web/
│   ├── admin-spring-boot-starter-security/
│   ├── admin-spring-boot-starter-mybatis/
│   ├── admin-spring-boot-starter-redis/
│   ├── admin-spring-boot-starter-mq/
│   ├── admin-spring-boot-starter-job/
│   ├── admin-spring-boot-starter-excel/
│   ├── admin-spring-boot-starter-monitor/
│   ├── admin-spring-boot-starter-protection/
│   ├── admin-spring-boot-starter-websocket/
│   ├── admin-spring-boot-starter-biz-data-permission/
│   ├── admin-spring-boot-starter-biz-operatelog/
│   └── pom.xml
├── admin-module-system/             # 系统管理模块
│   ├── admin-module-system-api/
│   ├── admin-module-system-biz/
│   └── pom.xml
├── admin-module-infra/              # 基础设施模块
│   ├── admin-module-infra-api/
│   ├── admin-module-infra-biz/
│   └── pom.xml
├── admin-module-log/                # 日志管理模块
│   ├── admin-module-log-api/
│   ├── admin-module-log-biz/
│   └── pom.xml
├── admin-module-monitor/            # 系统监控模块
│   ├── admin-module-monitor-api/
│   ├── admin-module-monitor-biz/
│   └── pom.xml
├── admin-module-report/             # 数据报表模块
│   ├── admin-module-report-api/
│   ├── admin-module-report-biz/
│   └── pom.xml
├── admin-common/                    # 公共基础模块
│   ├── src/main/java/
│   │   └── com/admin/common/
│   │       ├── core/                # 核心工具类
│   │       ├── enums/               # 枚举定义
│   │       ├── exception/           # 异常定义
│   │       └── util/                # 工具类
│   └── pom.xml
├── admin-server/                    # 服务启动模块
│   ├── src/main/java/
│   │   └── com/admin/AdminApplication.java
│   ├── src/main/resources/
│   │   ├── application.yml
│   │   ├── application-dev.yml
│   │   ├── application-prod.yml
│   │   └── application-test.yml
│   └── pom.xml
├── docs/                            # 文档目录
├── sql/                             # 数据库脚本
└── pom.xml                          # 根POM文件
```

### 3.3. 技术选型优势

#### 3.3.1. 核心框架优势
- **Spring Boot 3.x**: 基于JDK 21的现代化框架，提供更好的性能和开发体验
- **Spring Security 6.x**: 最新安全框架，支持现代化认证方式
- **MyBatis Plus 3.5.x**: 强大的ORM框架，提供代码生成和CRUD增强
- **Spring Cloud OpenFeign**: 声明式服务调用，支持模块间API通信

#### 3.3.2. 数据存储优势
- **MySQL 8.0**: 高性能关系型数据库，支持JSON字段和窗口函数
- **Redis 6.2.x**: 高性能缓存，支持多种数据结构和持久化
- **Redisson 3.x**: 功能丰富的Redis客户端，提供分布式锁和限流

#### 3.3.3. 中间件优势
- **RocketMQ 5.x**: 高性能消息队列，支持事务消息和顺序消息
- **Quartz**: 企业级定时任务调度，支持集群和持久化
- **Knife4j 3.0.x**: 现代化API文档，基于OpenAPI 3.0标准

#### 3.3.4. 工具库优势
- **Hutool 5.8.x**: 丰富的Java工具类，简化开发工作
- **Jackson 2.13.x**: 高性能JSON处理，支持多种数据格式
- **EasyExcel 3.x**: 高性能Excel处理，支持大数据量导入导出
- **MinIO 8.4.x**: 云原生对象存储，兼容Amazon S3 API

### 3.4. 分层架构

采用传统三层架构，实现清晰的职责分离：

```
┌─────────────────────────────────────────────────────────────┐
│                    表现层 (Controller Layer)                │
│  Controller: 处理HTTP请求，参数校验，返回响应                 │
│  依赖: Service Layer                                        │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                   业务服务层 (Service Layer)                 │
│  Service: 业务逻辑处理，事务管理，业务规则校验                │
│  依赖: Mapper Layer                                         │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                  数据访问层 (Mapper Layer)                   │
│  Mapper: 数据库操作，SQL映射，数据持久化                     │
│  依赖: Database                                             │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    数据层 (Data Layer)                      │
│  Database: MySQL, Redis, MinIO, RocketMQ                   │
└─────────────────────────────────────────────────────────────┘
```

#### 3.4.1 层级职责说明

| 层级 | 主要职责 | 依赖方向 | 核心原则 |
|------|----------|----------|----------|
| **表现层** | HTTP请求处理、参数校验、响应格式化 | → Service | 薄层，只做数据转换 |
| **业务服务层** | 业务逻辑处理、事务管理、权限校验 | → Mapper | 业务核心，处理复杂逻辑 |
| **数据访问层** | 数据库操作、SQL映射、数据持久化 | → Database | 数据访问，封装SQL |

#### 3.4.2 典型调用链路

```java
// Controller层
@RestController
public class UserController {
    @Autowired
    private UserService userService;
    
    @GetMapping("/user/{id}")
    public Result<User> getUser(@PathVariable Long id) {
        User user = userService.getUserById(id);
        return Result.success(user);
    }
}

// Service层
@Service
public class UserService {
    @Autowired
    private UserMapper userMapper;
    
    public User getUserById(Long id) {
        return userMapper.selectById(id);
    }
}

// Mapper层
@Mapper
public interface UserMapper extends BaseMapper<User> {
    // MyBatis-Plus提供基础CRUD
}
```

## 4. 架构优势

### 4.1. 模块化单体架构优势
- **渐进式演进**: 支持从单体架构向微服务架构平滑演进
- **开发效率高**: 单体部署，开发调试简单，适合中小型团队
- **运维成本低**: 单一部署单元，降低运维复杂度
- **性能优异**: 本地调用性能高，避免网络开销

### 4.2. Spring Boot Starter模式优势
- **组件化封装**: 技术组件封装为Starter，开箱即用
- **配置简化**: 自动配置减少样板代码，提高开发效率
- **版本统一**: 依赖版本统一管理，避免冲突
- **易于扩展**: 新技术组件可以独立开发和集成

### 4.3. API-BIZ分层设计优势
- **接口标准化**: API包定义标准接口，支持本地和远程调用
- **业务隔离**: BIZ包实现具体业务逻辑，模块间解耦
- **可测试性**: 接口和实现分离，便于单元测试和集成测试
- **扩展性强**: 支持未来拆分为微服务架构

### 4.4. 技术栈优势
- **现代化技术栈**: 采用业界主流技术，社区活跃，文档完善
- **高性能**: Redis缓存、连接池优化、SQL优化提供高性能支持
- **高可用**: 支持集群部署、故障转移、熔断降级
- **可观测性**: 完善的监控、日志、链路追踪体系
- **安全性**: 多层次安全防护，数据加密，权限控制

## 5. 核心组件设计

### 5.1. 模块间通信机制

#### 4.1.1 API接口定义

各模块通过API包定义清晰的接口进行通信：

```java
// admin-module-system-api
@FeignClient(name = "admin-system", path = "/admin-api/system")
public interface UserApi {
    
    @GetMapping("/user/get")
    CommonResult<UserRespVO> getUser(@RequestParam("id") Long id);
    
    @GetMapping("/user/list-by-ids")
    CommonResult<List<UserRespVO>> getUserList(@RequestParam("ids") Collection<Long> ids);
    
    @PostMapping("/user/valid")
    CommonResult<Boolean> validateUser(@RequestBody UserValidateReqVO reqVO);
}

// admin-module-system-api
public interface RoleApi {
    
    @GetMapping("/role/list-by-user-id")
    CommonResult<List<RoleRespVO>> getRoleListByUserId(@RequestParam("userId") Long userId);
    
    @PostMapping("/permission/has")
    CommonResult<Boolean> hasAnyPermissions(@RequestBody PermissionValidateReqVO reqVO);
}
```

#### 4.1.2 模块内部调用

同一模块内部通过Service接口进行调用：

```java
// admin-module-system-biz
@Service
public class AuthServiceImpl implements AuthService {
    
    @Resource
    private UserService userService;
    
    @Resource
    private RoleService roleService;
    
    @Override
    public LoginRespVO login(LoginReqVO reqVO) {
        // 调用同模块内的用户服务
        UserDO user = userService.getUserByUsername(reqVO.getUsername());
        
        // 调用同模块内的角色服务
        List<RoleRespVO> roles = roleService.getRoleListByUserId(user.getId());
        
        return buildLoginResult(user, roles);
    }
}
```

#### 4.1.3 跨模块调用

跨模块通过API接口进行调用，支持本地调用和远程调用：

```java
// admin-module-log-biz
@Service
public class OperateLogServiceImpl implements OperateLogService {
    
    @Resource
    private UserApi userApi; // 跨模块调用用户API
    
    @Override
    public PageResult<OperateLogRespVO> getOperateLogPage(OperateLogPageReqVO reqVO) {
        // 查询操作日志
        PageResult<OperateLogDO> pageResult = operateLogMapper.selectPage(reqVO);
        
        // 跨模块获取用户信息
        Set<Long> userIds = convertSet(pageResult.getList(), OperateLogDO::getUserId);
        Map<Long, UserRespVO> userMap = userApi.getUserList(userIds).getData()
                .stream().collect(Collectors.toMap(UserRespVO::getId, Function.identity()));
        
        // 组装返回结果
        return OperateLogConvert.INSTANCE.convertPage(pageResult, userMap);
    }
}
```

#### 4.1.4 事件驱动解耦

对于松耦合的模块间通信，采用事件驱动模式：

```java
// admin-common - 事件定义
public class UserCreatedEvent extends ApplicationEvent {
    private final Long userId;
    private final String username;
    
    public UserCreatedEvent(Object source, Long userId, String username) {
        super(source);
        this.userId = userId;
        this.username = username;
    }
}

// admin-module-system-biz - 事件发布
@Service
public class UserServiceImpl implements UserService {
    
    @Resource
    private ApplicationEventPublisher eventPublisher;
    
    @Override
    @Transactional(rollbackFor = Exception.class)
    public Long createUser(UserCreateReqVO reqVO) {
        // 创建用户逻辑
        UserDO user = doCreateUser(reqVO);
        
        // 发布事件
        eventPublisher.publishEvent(new UserCreatedEvent(this, user.getId(), user.getUsername()));
        
        return user.getId();
    }
}

// admin-module-log-biz - 事件监听
@Component
public class UserEventListener {
    
    @EventListener
    @Async
    public void handleUserCreated(UserCreatedEvent event) {
        // 记录用户创建日志
        OperateLogCreateReqVO logReqVO = new OperateLogCreateReqVO();
        logReqVO.setUserId(event.getUserId());
        logReqVO.setModule("用户管理");
        logReqVO.setName("创建用户");
        logReqVO.setContent("创建用户：" + event.getUsername());
        operateLogService.createOperateLog(logReqVO);
    }
}
```

#### 4.1.5 Maven依赖管理

```xml
<!-- admin-server模块依赖 -->
<dependencies>
    <!-- 业务模块BIZ包 -->
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-module-system-biz</artifactId>
    </dependency>
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-module-infra-biz</artifactId>
    </dependency>
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-module-log-biz</artifactId>
    </dependency>
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-module-monitor-biz</artifactId>
    </dependency>
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-module-report-biz</artifactId>
    </dependency>
</dependencies>

<!-- 业务模块BIZ包依赖 -->
<dependencies>
    <!-- 同模块API包 -->
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-module-system-api</artifactId>
    </dependency>
    <!-- 其他模块API包（跨模块调用） -->
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-module-infra-api</artifactId>
    </dependency>
    <!-- 框架组件 -->
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-spring-boot-starter-security</artifactId>
    </dependency>
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-spring-boot-starter-mybatis</artifactId>
    </dependency>
    <!-- 公共模块 -->
    <dependency>
        <groupId>com.admin</groupId>
        <artifactId>admin-common</artifactId>
    </dependency>
</dependencies>
```

### 4.2. 认证授权组件

- **JWT Token管理**: 生成、验证、刷新Token
- **权限拦截器**: 基于注解的权限控制
- **登录状态管理**: Redis存储用户会话信息
- **密码加密**: BCrypt加密算法

### 4.3. 权限管理组件

- **RBAC模型**: 用户-角色-权限三层模型
- **权限缓存**: Redis缓存用户权限信息
- **动态权限**: 支持运行时权限变更
- **权限注解**: @PreAuthorize注解控制方法级权限

### 4.4. 分布式锁组件

- **Redisson客户端**: 基于Redis的分布式锁实现
- **可重入锁**: RLock支持同一线程多次获取锁
- **公平锁**: RFairLock按请求顺序获取锁
- **读写锁**: RReadWriteLock支持读写分离
- **分布式信号量**: RSemaphore控制并发访问数量
- **分布式闭锁**: RCountDownLatch等待多个任务完成
- **锁超时机制**: 自动释放超时锁，防止死锁
- **锁续期机制**: WatchDog自动延长锁有效期

### 4.5. 消息队列组件

- **RocketMQ集成**: 高性能分布式消息中间件
- **生产者配置**: 支持同步、异步、单向发送
- **消费者配置**: 支持集群消费和广播消费
- **消息类型**: 普通消息、顺序消息、延时消息
- **事务消息**: 支持分布式事务消息
- **消息重试**: 自动重试机制和死信队列
- **消息过滤**: Tag和SQL表达式过滤
- **消息追踪**: 消息轨迹跟踪和监控

### 4.6. 文件管理组件

- **MinIO集成**: 对象存储服务
- **文件上传**: 支持单文件、多文件、分片上传
- **文件下载**: 支持断点续传
- **文件预览**: 图片、文档在线预览

### 4.7. Excel导入导出组件

- **EasyExcel集成**: 高性能Excel读写库
- **数据导入**: 支持大文件读取、流式处理
- **数据导出**: 支持大数据量导出、内存优化
- **模板管理**: 导入导出模板定义和管理
- **数据校验**: 导入数据格式校验、业务规则校验
- **异步处理**: 大文件异步导入导出
- **进度跟踪**: 导入导出进度实时反馈
- **错误处理**: 详细的错误信息和异常处理

### 4.8. 日志管理组件

- **操作日志**: AOP切面记录用户操作
- **登录日志**: 记录用户登录行为
- **系统日志**: 异常日志、性能日志
- **日志存储**: 数据库存储，支持检索

### 4.9. 监控组件

- **系统监控**: CPU、内存、磁盘使用率
- **JVM监控**: 堆内存、GC信息
- **数据库监控**: 连接池状态
- **在线用户**: WebSocket连接管理

## 5. 数据库设计原则

### 5.1. 设计原则

- **规范化**: 遵循第三范式，减少数据冗余
- **性能优化**: 合理使用索引，避免深度关联
- **扩展性**: 预留扩展字段，支持业务发展
- **安全性**: 敏感数据加密存储

### 5.2. 命名规范

- **表名**: 小写字母，下划线分隔，如 `sys_user`
- **字段名**: 小写字母，下划线分隔，如 `user_name`
- **索引名**: `idx_表名_字段名`，如 `idx_sys_user_username`
- **主键**: 统一使用 `id` 作为主键名

### 5.3. 公共字段

所有业务表都应包含以下公共字段：

```sql
create_by     varchar(64)   comment '创建者',
create_time   datetime      comment '创建时间',
update_by     varchar(64)   comment '更新者',
update_time   datetime      comment '更新时间',
remark        varchar(500)  comment '备注'
```

## 6. 接口设计规范

### 6.1. RESTful API设计

- **GET**: 查询操作
- **POST**: 新增操作
- **PUT**: 更新操作
- **DELETE**: 删除操作

### 6.2. 统一响应格式

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": 1640995200000
}
```

### 6.3. 分页响应格式

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "records": [],
    "total": 100,
    "size": 10,
    "current": 1,
    "pages": 10
  }
}
```

## 7. 安全设计

### 7.1. 认证安全

- **JWT Token**: 无状态认证，支持分布式
- **Token刷新**: 双Token机制，提高安全性
- **登录限制**: 失败次数限制，账户锁定
- **密码策略**: 复杂度要求，定期更换

### 7.2. 授权安全

- **最小权限原则**: 用户只拥有必要权限
- **权限校验**: 接口级、按钮级权限控制
- **数据权限**: 基于部门、角色的数据隔离

### 7.3. 传输安全

- **HTTPS**: 加密传输
- **CORS**: 跨域请求控制
- **XSS防护**: 输入输出过滤
- **SQL注入防护**: 参数化查询

## 8. 性能优化

### 8.1. 数据库优化

- **索引优化**: 合理创建索引
- **查询优化**: 避免N+1查询
- **连接池**: HikariCP高性能连接池
- **读写分离**: 支持主从分离（可选）

### 8.2. 缓存策略

- **Redis缓存**: 热点数据缓存
- **本地缓存**: Caffeine本地缓存
- **缓存更新**: 缓存一致性保证
- **缓存穿透**: 布隆过滤器防护

### 8.3. 分布式锁优化

- **锁粒度控制**: 细粒度锁减少竞争
- **锁超时设置**: 合理设置锁超时时间
- **锁重试机制**: 指数退避重试策略
- **锁监控**: 锁持有时间和竞争情况监控

### 8.4. 消息队列优化

- **批量发送**: 提高消息发送吞吐量
- **消费者并发**: 合理设置消费线程数
- **消息压缩**: 减少网络传输开销
- **消息序列化**: 选择高效序列化方式
- **消费者负载均衡**: 平均分配消息到消费者

### 8.5. 前端优化

- **代码分割**: 路由懒加载
- **资源压缩**: Gzip压缩
- **CDN加速**: 静态资源CDN
- **缓存策略**: 浏览器缓存控制

## 9. 分布式组件配置

### 9.1 Redisson配置

```yaml
spring:
  redis:
    redisson:
      config: |
        singleServerConfig:
          address: "redis://127.0.0.1:6379"
          password: null
          database: 0
          connectionPoolSize: 64
          connectionMinimumIdleSize: 10
        threads: 16
        nettyThreads: 32
        codec: !<org.redisson.codec.JsonJacksonCodec> {}
```

### 9.2 RocketMQ配置

```yaml
rocketmq:
  name-server: 127.0.0.1:9876
  producer:
    group: admin-producer-group
    send-message-timeout: 3000
    retry-times-when-send-failed: 2
  consumer:
    group: admin-consumer-group
    consume-thread-min: 5
    consume-thread-max: 32
    consume-message-batch-max-size: 1
```

### 9.3 EasyExcel配置

```yaml
# 文件上传配置
spring:
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
      enabled: true

# Excel处理配置
excel:
  import:
    max-rows: 10000        # 最大导入行数
    batch-size: 1000       # 批处理大小
    async-threshold: 5000  # 异步处理阈值
  export:
    max-rows: 100000       # 最大导出行数
    memory-threshold: 50000 # 内存阈值
```

### 9.4 使用场景

#### 分布式锁应用场景
- **定时任务**: 防止多实例重复执行
- **库存扣减**: 防止超卖问题
- **订单生成**: 防止重复下单
- **缓存更新**: 防止缓存击穿

#### 消息队列应用场景
- **异步通知**: 用户注册成功通知
- **数据同步**: 用户信息变更同步
- **日志处理**: 操作日志异步入库
- **邮件发送**: 异步发送邮件通知

#### Excel导入导出应用场景
- **用户批量导入**: 批量导入用户信息
- **数据批量导出**: 导出用户、角色、日志等数据
- **报表生成**: 生成各类统计报表
- **数据备份**: 定期导出数据备份

## 10. 部署架构

### 10.1 开发环境
- 单机部署
- 内嵌数据库H2（可选）
- 本地Redis
- 本地RocketMQ

### 10.2 测试环境
- Docker容器化部署
- MySQL数据库
- Redis集群
- RocketMQ集群

### 10.3 生产环境
- Kubernetes集群部署
- 高可用MySQL集群
- Redis哨兵模式
- RocketMQ集群部署
- 负载均衡器
- 监控告警系统

---

*（系统架构文档已完成，请审阅技术选型和架构设计是否符合项目需求。）*





<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.admin.module.log.biz.dal.mapper.OperationLogMapper">

    <sql id="selectOperationLogVo">
        select id, title, business_type, method, request_method, operator_type, oper_name, dept_name, 
               oper_url, oper_ip, oper_location, oper_param, json_result, status, error_msg, 
               oper_time, cost_time, create_time, update_time, create_by, update_by, deleted
        from sys_operation_log
    </sql>

    <sql id="whereCondition">
        <where>
            deleted = 0
            <if test="query.title != null and query.title != ''">
                AND title LIKE CONCAT('%', #{query.title}, '%')
            </if>
            <if test="query.businessType != null">
                AND business_type = #{query.businessType}
            </if>
            <if test="query.operName != null and query.operName != ''">
                AND oper_name LIKE CONCAT('%', #{query.operName}, '%')
            </if>
            <if test="query.status != null">
                AND status = #{query.status}
            </if>
            <if test="query.requestMethod != null and query.requestMethod != ''">
                AND request_method = #{query.requestMethod}
            </if>
            <if test="query.operatorType != null">
                AND operator_type = #{query.operatorType}
            </if>
            <if test="query.operLocation != null and query.operLocation != ''">
                AND oper_location LIKE CONCAT('%', #{query.operLocation}, '%')
            </if>
            <if test="query.minCostTime != null">
                AND cost_time >= #{query.minCostTime}
            </if>
            <if test="query.maxCostTime != null">
                AND cost_time <= #{query.maxCostTime}
            </if>
            <if test="query.startTime != null and query.endTime != null">
                AND oper_time BETWEEN #{query.startTime} AND #{query.endTime}
            </if>
        </where>
    </sql>

    <select id="selectPageByQuery" resultType="com.admin.module.log.biz.dal.dataobject.OperationLogDO">
        <include refid="selectOperationLogVo"/>
        <include refid="whereCondition"/>
        ORDER BY id DESC
    </select>

    <select id="selectCountByQuery" resultType="java.lang.Long">
        SELECT COUNT(1) FROM sys_operation_log
        <include refid="whereCondition"/>
    </select>

    <select id="selectListByQuery" resultType="com.admin.module.log.biz.dal.dataobject.OperationLogDO">
        <include refid="selectOperationLogVo"/>
        <include refid="whereCondition"/>
        ORDER BY id DESC
        <if test="query.pageNum != null and query.pageSize != null">
            LIMIT #{query.pageSize} OFFSET #{query.offset}
        </if>
    </select>

</mapper>
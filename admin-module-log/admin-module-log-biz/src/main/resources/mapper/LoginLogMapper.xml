<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.admin.module.log.biz.dal.mapper.LoginLogMapper">

    <sql id="selectLoginLogVo">
        select id, user_name, login_type, ipaddr, login_location, browser, os, status, msg, 
               login_time, create_time, update_time, create_by, update_by, deleted
        from sys_login_log
    </sql>

    <sql id="whereCondition">
        <where>
            deleted = 0
            <if test="query.userName != null and query.userName != ''">
                AND user_name LIKE CONCAT('%', #{query.userName}, '%')
            </if>
            <if test="query.loginType != null">
                AND login_type = #{query.loginType}
            </if>
            <if test="query.ipaddr != null and query.ipaddr != ''">
                AND ipaddr LIKE CONCAT('%', #{query.ipaddr}, '%')
            </if>
            <if test="query.loginLocation != null and query.loginLocation != ''">
                AND login_location LIKE CONCAT('%', #{query.loginLocation}, '%')
            </if>
            <if test="query.status != null">
                AND status = #{query.status}
            </if>
            <if test="query.startTime != null and query.endTime != null">
                AND login_time BETWEEN #{query.startTime} AND #{query.endTime}
            </if>
        </where>
    </sql>

    <select id="selectPageByQuery" resultType="com.admin.module.log.biz.dal.dataobject.LoginLogDO">
        <include refid="selectLoginLogVo"/>
        <include refid="whereCondition"/>
        ORDER BY id DESC
    </select>

    <select id="selectCountByQuery" resultType="java.lang.Long">
        SELECT COUNT(1) FROM sys_login_log
        <include refid="whereCondition"/>
    </select>

    <select id="selectListByQuery" resultType="com.admin.module.log.biz.dal.dataobject.LoginLogDO">
        <include refid="selectLoginLogVo"/>
        <include refid="whereCondition"/>
        ORDER BY id DESC
        <if test="query.pageNum != null and query.pageSize != null">
            LIMIT #{query.pageSize} OFFSET #{query.offset}
        </if>
    </select>

</mapper>